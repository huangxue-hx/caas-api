<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.harmonycloud.dao.application.BusinessMapper" >
  <resultMap id="BaseResultMap" type="com.harmonycloud.dao.application.bean.Business" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="template_id" property="templateId" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="details" property="details" jdbcType="VARCHAR" />
    <result column="namespaces" property="namespaces" jdbcType="VARCHAR" />
    <result column="user" property="user" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="tenant" property="tenant" jdbcType="VARCHAR" />
  </resultMap>
 
  <select id="search" parameterType="java.lang.String" resultMap="BaseResultMap">
    select * from business where 1=1
    	<if test=" namespace != null and namespace.length != 0">
         and namespaces in
    	  <foreach item="item" index="index" collection="namespace" open="(" separator="," close=")">  
        	#{item}
          </foreach>
        </if>
    	<if test=" name != null and name != '' ">
          and name like concat(concat('%',#{name}),'%') 
    	</if>
    	<if test=" tenant != null and tenant.length != 0">
         and tenant in
    	  <foreach item="item" index="index" collection="tenant" open="(" separator="," close=")">  
        	#{item}
          </foreach>
        </if>
  </select>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select * from business where id = #{id}
  </select>

  <insert id="insert" parameterType="com.harmonycloud.dao.application.bean.Business" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO business (template_id,name,details,namespaces,user,create_time,tenant) VALUE (#{templateId},#{name},#{details},#{namespaces},#{user},#{createTime},#{tenant})
  </insert>

  <delete id="deleteBusinessById"  parameterType="java.lang.Integer">
      DELETE FROM business WHERE id = #{id}
  </delete>

	<delete id="deleteBusinessByNamespace"  parameterType="java.lang.String">
      DELETE FROM business WHERE namespaces = #{namespace}
  </delete>

</mapper>
