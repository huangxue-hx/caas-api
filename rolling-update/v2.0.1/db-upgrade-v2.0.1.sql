--更新应用商店(集群组件)
ALTER TABLE `k8s_auth_server`.`service_templates`
ADD COLUMN `service_account` VARCHAR(255) NULL DEFAULT NULL AFTER `cluster_id`;

UPDATE `k8s_auth_server`.`service_templates` SET `deployment_content` = '[{"annotation":"","automountServiceAccountToken":false,"clusterIP":"","containers":[{"args":[],"command":[],"configmap":[],"env":[{"key":"MINIMUM_MASTER_NODES","name":"","value":"1"},{"key":"TZ","name":"","value":"Asia/Shanghai"}],"imagePullPolicy":"Always","img":"onlineshop/elasticsearch","lifecycle":null,"limit":null,"livenessProbe":null,"log":"","name":"elasticsearch","ports":[{"containerPort":"","expose":"true","port":"9200","protocol":"TCP"},{"containerPort":"","expose":"true","port":"9300","protocol":"TCP"}],"readinessProbe":null,"resource":{"cpu":"1000m","currentRate":0,"memory":"1024"},"securityContext":{"add":[],"drop":[],"privileged":false,"security":false},"storage":[{"bindOne":false,"capacity":"5Gi","clusterId":"","emptyDir":"","gitUrl":"","hostPath":"","namespace":"","path":"/data","projectId":"","pvcName":"es-data","readOnly":false,"revision":"","serviceName":"","serviceType":"","tenantId":"","type":"nfs","volumeName":""},{"bindOne":false,"capacity":"5Gi","clusterId":"","emptyDir":"","gitUrl":"","hostPath":"","namespace":"","path":"/data-backup","projectId":"","pvcName":"es-data-backup","readOnly":false,"revision":"","serviceName":"","serviceType":"","tenantId":"","type":"nfs","volumeName":""}],"syncTimeZone":false,"tag":"v6.2.5-1"}],"hostIPC":false,"hostName":"","hostNetwork":false,"hostPID":false,"instance":"1","labels":"","logPath":"","logService":"","name":"elasticsearch","namespace":"","nodeAffinity":[],"nodeSelector":"","podAffinity":null,"podAntiAffinity":null,"podDisperse":null,"projectId":"","restartPolicy":"Always","serviceAccount":"","serviceAccountName":"","sessionAffinity":""}]' WHERE (`id` = '11' AND `name` = 'elasticsearch');
UPDATE `k8s_auth_server`.`service_templates` SET `service_account` = 'onlineshop' WHERE (`id` = '11' AND `name` = 'elasticsearch');

INSERT INTO `k8s_auth_server`.`service_templates` (`name`, `tag`, `deployment_content`, `image_list`, `is_public`, `status`, `tenant`, `create_user`, `create_time`, `flag`, `node_selector`) VALUES ('rocketmq', '1.0', '[{\"annotation\":\"\",\"automountServiceAccountToken\":false,\"clusterIP\":\"\",\"containers\":[{\"args\":[],\"command\":[],\"configmap\":[],\"env\":[{\"key\":\"TZ\",\"name\":\"\",\"value\":\"Asia/Shanghai\"}],\"imagePullPolicy\":\"IfNotPresent\",\"img\":\"onlineshop/rocketmq-broker\",\"lifecycle\":null,\"limit\":null,\"livenessProbe\":null,\"log\":\"\",\"name\":\"rocketmq-broker\",\"ports\":[{\"containerPort\":\"\",\"expose\":\"true\",\"port\":\"10909\",\"protocol\":\"TCP\"},{\"containerPort\":\"\",\"expose\":\"true\",\"port\":\"10911\",\"protocol\":\"TCP\"}],\"readinessProbe\":null,\"resource\":{\"cpu\":\"1000m\",\"currentRate\":0,\"memory\":\"8192\"},\"securityContext\":{\"add\":[],\"drop\":[],\"privileged\":false,\"security\":false},\"storage\":[{\"bindOne\":false,\"capacity\":\"5Gi\",\"clusterId\":\"\",\"emptyDir\":\"\",\"gitUrl\":\"\",\"hostPath\":\"\",\"namespace\":\"\",\"path\":\"/opt/logs\",\"projectId\":\"\",\"pvcName\":\"rocketmq-broker-logs\",\"readOnly\":false,\"revision\":\"\",\"serviceName\":\"\",\"serviceType\":\"\",\"tenantId\":\"\",\"type\":\"nfs\",\"volumeName\":\"\"},{\"bindOne\":false,\"capacity\":\"5Gi\",\"clusterId\":\"\",\"emptyDir\":\"\",\"gitUrl\":\"\",\"hostPath\":\"\",\"namespace\":\"\",\"path\":\"/opt/store\",\"projectId\":\"\",\"pvcName\":\"rocketmq-broker-store\",\"readOnly\":false,\"revision\":\"\",\"serviceName\":\"\",\"serviceType\":\"\",\"tenantId\":\"\",\"type\":\"nfs\",\"volumeName\":\"\"}],\"syncTimeZone\":false,\"tag\":\"4.2.0-k8s\"},{\"args\":[],\"command\":[],\"configmap\":[],\"env\":[{\"key\":\"TZ\",\"name\":\"\",\"value\":\"Asia/Shanghai\"}],\"imagePullPolicy\":\"IfNotPresent\",\"img\":\"onlineshop/rocketmq-namesrv\",\"lifecycle\":null,\"limit\":null,\"livenessProbe\":null,\"log\":\"\",\"name\":\"rocketmq-namesrv\",\"ports\":[{\"containerPort\":\"\",\"expose\":\"true\",\"port\":\"9876\",\"protocol\":\"TCP\"}],\"readinessProbe\":null,\"resource\":{\"cpu\":\"1000m\",\"currentRate\":0,\"memory\":\"8192\"},\"securityContext\":{\"add\":[],\"drop\":[],\"privileged\":false,\"security\":false},\"storage\":[{\"bindOne\":false,\"capacity\":\"5Gi\",\"clusterId\":\"\",\"emptyDir\":\"\",\"gitUrl\":\"\",\"hostPath\":\"\",\"namespace\":\"\",\"path\":\"/opt/logs\",\"projectId\":\"\",\"pvcName\":\"rocketmq-namesrv-logs\",\"readOnly\":false,\"revision\":\"\",\"serviceName\":\"\",\"serviceType\":\"\",\"tenantId\":\"\",\"type\":\"nfs\",\"volumeName\":\"\"},{\"bindOne\":false,\"capacity\":\"5Gi\",\"clusterId\":\"\",\"emptyDir\":\"\",\"gitUrl\":\"\",\"hostPath\":\"\",\"namespace\":\"\",\"path\":\"/opt/store\",\"projectId\":\"\",\"pvcName\":\"rocketmq-namesrv-store\",\"readOnly\":false,\"revision\":\"\",\"serviceName\":\"\",\"serviceType\":\"\",\"tenantId\":\"\",\"type\":\"nfs\",\"volumeName\":\"\"}],\"syncTimeZone\":false,\"tag\":\"4.2.0-k8s\"}],\"hostIPC\":false,\"hostName\":\"\",\"hostNetwork\":false,\"hostPID\":false,\"instance\":\"1\",\"labels\":\"\",\"logPath\":\"\",\"logService\":\"\",\"name\":\"rocketmq\",\"namespace\":\"\",\"nodeAffinity\":[],\"nodeSelector\":\"\",\"podAffinity\":null,\"podAntiAffinity\":null,\"podDisperse\":null,\"projectId\":\"\",\"restartPolicy\":\"Always\",\"serviceAccount\":\"\",\"serviceAccountName\":\"\",\"sessionAffinity\":\"\"}]', 'onlineshop/rocketmq-broker,onlineshop/rocketmq-namesrv', '0', '1', 'all', 'admin', '2018-08-06 18:11:03', '0', 'HarmonyCloud_Status=C');
INSERT INTO `k8s_auth_server`.`service_templates` (`name`, `tag`, `deployment_content`, `image_list`, `is_public`, `status`, `tenant`, `create_user`, `create_time`, `flag`, `node_selector`) VALUES ('mysql-master', '1.0', '[{\"annotation\":\"\",\"automountServiceAccountToken\":false,\"clusterIP\":\"\",\"containers\":[{\"args\":[],\"command\":[],\"configmap\":[],\"env\":[{\"key\":\"MYSQL_ROOT_PASSWORD\",\"name\":\"\",\"value\":\"123456\"},{\"key\":\"MYSQL_REPLICATION_USER\",\"name\":\"\",\"value\":\"repl\"},{\"key\":\"MYSQL_REPLICAITON_PASSWORD\",\"name\":\"\",\"value\":\"123456\"},{\"key\":\"TZ\",\"name\":\"\",\"value\":\"Asia/Shanghai\"}],\"imagePullPolicy\":\"IfNotPresent\",\"img\":\"onlineshop/mysql-master\",\"lifecycle\":null,\"limit\":null,\"livenessProbe\":null,\"log\":\"\",\"name\":\"mysql-master\",\"ports\":[{\"containerPort\":\"\",\"expose\":\"true\",\"port\":\"3306\",\"protocol\":\"TCP\"}],\"readinessProbe\":null,\"resource\":{\"cpu\":\"1000m\",\"currentRate\":0,\"memory\":\"1024\"},\"securityContext\":{\"add\":[],\"drop\":[],\"privileged\":false,\"security\":false},\"storage\":[{\"bindOne\":false,\"capacity\":\"5Gi\",\"clusterId\":\"\",\"emptyDir\":\"\",\"gitUrl\":\"\",\"hostPath\":\"\",\"namespace\":\"\",\"path\":\"/var/lib/mysql\",\"projectId\":\"\",\"pvcName\":\"mysql-master-data\",\"readOnly\":false,\"revision\":\"\",\"serviceName\":\"\",\"serviceType\":\"\",\"tenantId\":\"\",\"type\":\"nfs\",\"volumeName\":\"\"}],\"syncTimeZone\":false,\"tag\":\"0.1\"}],\"hostIPC\":false,\"hostName\":\"\",\"hostNetwork\":false,\"hostPID\":false,\"instance\":\"1\",\"labels\":\"\",\"logPath\":\"\",\"logService\":\"\",\"name\":\"mysql-master\",\"namespace\":\"\",\"nodeAffinity\":[],\"nodeSelector\":\"\",\"podAffinity\":null,\"podAntiAffinity\":null,\"podDisperse\":null,\"projectId\":\"\",\"restartPolicy\":\"Always\",\"serviceAccount\":\"\",\"serviceAccountName\":\"\",\"sessionAffinity\":\"\"}]', 'onlineshop/mysql-master', '0', '1', 'all', 'admin', '2018-08-06 19:06:51', '0', 'HarmonyCloud_Status=C');
INSERT INTO `k8s_auth_server`.`service_templates` (`name`, `tag`, `deployment_content`, `image_list`, `is_public`, `status`, `tenant`, `create_user`, `create_time`, `flag`, `node_selector`) VALUES ('mysql-slave', '1.0', '[{\"annotation\":\"\",\"automountServiceAccountToken\":false,\"clusterIP\":\"\",\"containers\":[{\"args\":[],\"command\":[],\"configmap\":[],\"env\":[{\"key\":\"MYSQL_ROOT_PASSWORD\",\"name\":\"\",\"value\":\"123456\"},{\"key\":\"MYSQL_REPLICATION_USER\",\"name\":\"\",\"value\":\"repl\"},{\"key\":\"MYSQL_REPLICAITON_PASSWORD\",\"name\":\"\",\"value\":\"123456\"},{\"key\":\"TZ\",\"name\":\"\",\"value\":\"Asia/Shanghai\"}],\"imagePullPolicy\":\"IfNotPresent\",\"img\":\"onlineshop/mysql-slave\",\"lifecycle\":null,\"limit\":null,\"livenessProbe\":null,\"log\":\"\",\"name\":\"mysql-slave\",\"ports\":[{\"containerPort\":\"\",\"expose\":\"true\",\"port\":\"3306\",\"protocol\":\"TCP\"}],\"readinessProbe\":null,\"resource\":{\"cpu\":\"1000m\",\"currentRate\":0,\"memory\":\"1024\"},\"securityContext\":{\"add\":[],\"drop\":[],\"privileged\":false,\"security\":false},\"storage\":[{\"bindOne\":false,\"capacity\":\"5Gi\",\"clusterId\":\"\",\"emptyDir\":\"\",\"gitUrl\":\"\",\"hostPath\":\"\",\"namespace\":\"\",\"path\":\"/var/lib/mysql\",\"projectId\":\"\",\"pvcName\":\"mysql-slave-data\",\"readOnly\":false,\"revision\":\"\",\"serviceName\":\"\",\"serviceType\":\"\",\"tenantId\":\"\",\"type\":\"nfs\",\"volumeName\":\"\"}],\"syncTimeZone\":false,\"tag\":\"0.1\"}],\"hostIPC\":false,\"hostName\":\"\",\"hostNetwork\":false,\"hostPID\":false,\"instance\":\"1\",\"labels\":\"\",\"logPath\":\"\",\"logService\":\"\",\"name\":\"mysql-slave\",\"namespace\":\"\",\"nodeAffinity\":[],\"nodeSelector\":\"\",\"podAffinity\":null,\"podAntiAffinity\":null,\"podDisperse\":null,\"projectId\":\"\",\"restartPolicy\":\"Always\",\"serviceAccount\":\"\",\"serviceAccountName\":\"\",\"sessionAffinity\":\"\"}]', 'onlineshop/mysql-slave', '0', '1', 'all', 'admin', '2018-08-06 19:06:51', '0', 'HarmonyCloud_Status=C');

INSERT INTO `k8s_auth_server`.`application_templates` (`name`, `tag`, `status`, `tenant`, `create_user`, `create_time`, `image_list`, `is_public`, `project_id`) VALUES ('rocketmq', '1.0', '0', 'all', 'admin', '2018-08-06 18:11:03', 'onlineshop/rocketmq-broker,onlineshop/rocketmq-namesrv', '0', 'all');
INSERT INTO `k8s_auth_server`.`application_templates` (`name`, `tag`, `status`, `tenant`, `create_user`, `create_time`, `image_list`, `is_public`, `project_id`) VALUES ('mysql-cluster', '1.0', '0', 'all', 'admin', '2018-08-06 19:06:51', 'onlineshop/mysql-master,onlineshop/mysql-slave', '0', 'all');
UPDATE `k8s_auth_server`.`application_templates` SET `tag`='v6.2.5-1' WHERE (`id`='11' AND `name` = `Elasticsearch`)

INSERT INTO `k8s_auth_server`.`app_store` (`name`, `tag`, `type`, `create_user`, `create_time`) VALUES ('Rocketmq', '4.2.0-k8s', 'am', 'admin', '2018-08-06 18:18:04');
INSERT INTO `k8s_auth_server`.`app_store` (`name`, `tag`, `type`, `create_user`, `create_time`) VALUES ('Mysql-Cluster', '0.1', 'database', 'admin', '2018-08-06 19:13:07');
UPDATE `k8s_auth_server`.`app_store` SET `tag` = 'v6.2.5-1' WHERE (`id` = '11' AND `name` = `Elasticsearch`);

INSERT INTO `k8s_auth_server`.`application_service` (`application_id`, `service_id`, `status`, `is_external`) VALUES((SELECT `id` FROM `k8s_auth_server`.`application_templates` WHERE (`name` = 'rocketmq')),(SELECT `id` FROM `k8s_auth_server`.`service_templates` WHERE (`name` = 'rocketmq')),0,0);
INSERT INTO `k8s_auth_server`.`application_service` (`application_id`, `service_id`, `status`, `is_external`) VALUES((SELECT `id` FROM `k8s_auth_server`.`application_templates` WHERE (`name` = 'mysql-cluster')),(SELECT `id` FROM `k8s_auth_server`.`service_templates` WHERE (`name` = 'mysql-master')),0,0);
INSERT INTO `k8s_auth_server`.`application_service` (`application_id`, `service_id`, `status`, `is_external`) VALUES((SELECT `id` FROM `k8s_auth_server`.`application_templates` WHERE (`name` = 'mysql-cluster')),(SELECT `id` FROM `k8s_auth_server`.`service_templates` WHERE (`name` = 'mysql-slave')),0,0);

INSERT INTO `k8s_auth_server`.`app_store_service` (`app_id`, `service_id`) VALUES((SELECT `id` FROM `k8s_auth_server`.`application_templates` WHERE (`name` = 'rocketmq')),(SELECT `id` FROM `k8s_auth_server`.`service_templates` WHERE (`name` = 'rocketmq')));
INSERT INTO `k8s_auth_server`.`app_store_service` (`app_id`, `service_id`) VALUES((SELECT `id` FROM `k8s_auth_server`.`application_templates` WHERE (`name` = 'mysql-cluster')),(SELECT `id` FROM `k8s_auth_server`.`service_templates` WHERE (`name` = 'mysql-master')));
INSERT INTO `k8s_auth_server`.`app_store_service` (`app_id`, `service_id`) VALUES((SELECT `id` FROM `k8s_auth_server`.`application_templates` WHERE (`name` = 'mysql-cluster')),(SELECT `id` FROM `k8s_auth_server`.`service_templates` WHERE (`name` = 'mysql-slave')));




